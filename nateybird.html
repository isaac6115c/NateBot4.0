<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NateyBird</title>
  <link rel="stylesheet" href="css/style.css"> 
  <script src="js/nav.js"></script>
  <style>
    body {
      margin: 0;
      background: var(--ui-bg);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    canvas {
      border: 2px solid var(--ui-accent);
      touch-action: none;
      margin: auto;
    }
    button {
      position: absolute;
      top: 65%;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 18px;
      border-radius: var(--radius);
      border: none;
      background: var(--ui-accent);
      color: var(--ui-text);
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="game.html" >Play</a></li>
      <li><a href="openings.html">Openings</a></li>
      <li><a href="mainevent.html">Main Event</a></li>
      <li><a href="achievements.html">Achievements</a></li>
      <li><a href="nateybird.html" class="active">NateyBird</a></li>
      <li><a href="peekyhatch.html">PeekyHatch</a></li>
    </ul>
  </nav>
  
  <canvas id="gameCanvas" width="320" height="480"></canvas>
  <button id="restartBtn">Restart</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const restartBtn = document.getElementById("restartBtn");

    const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    const birdImg = new Image();
    birdImg.src = "images/nateybird.png";

    const bgImg = new Image();
    bgImg.src = "images/nateybird-bg.png";

    const rookImg = new Image();
    rookImg.src = "images/pipes/rook.png";

    let bird, pipes, frame, score, gameState;

    function initGame() {
      bird = { 
        x: 50, 
        y: 200, 
        w: 34, 
        h: 24, 
        gravity: isMobile ? 0.5 : 0.6,
        lift: isMobile ? -7 : -10,
        velocity: 0 
      };
      pipes = [];
      frame = 0;
      score = 0;
      gameState = "start";
      restartBtn.style.display = "none";
    }

    function drawBackground() {
      ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
    }

    function drawBird() {
      ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h);
    }

    function updateBird() {
      bird.velocity += bird.gravity;
      bird.y += bird.velocity;
      if (bird.y + bird.h > canvas.height) endGame();
      if (bird.y < 0) bird.y = 0;
    }

    function drawPipes() {
      for (let p of pipes) {
        ctx.save();
        ctx.translate(p.x + p.w / 2, p.top); 
        ctx.scale(1, -1); 
        ctx.drawImage(rookImg, -p.w / 2, 0, p.w, p.top);
        ctx.restore();
        ctx.drawImage(rookImg, p.x, canvas.height - p.bottom, p.w, p.bottom);
      }
    }

    function birdHitbox(b) {
      return { x: b.x + 4, y: b.y + 4, w: b.w - 8, h: b.h - 8 };
    }

    function isColliding(b, p) {
      const padding = 10;
      const bb = birdHitbox(b);
      return (
        bb.x < p.x + p.w - padding &&
        bb.x + bb.w > p.x + padding &&
        (bb.y < p.top - padding || bb.y + bb.h > canvas.height - p.bottom + padding)
      );
    }

    function updatePipes() {
      if (frame % 100 === 0) {
        let top = Math.random() * 180 + 20;
        let gap = 115;
        let pipeWidth = 70; 
        pipes.push({ x: canvas.width, w: pipeWidth, top: top, bottom: canvas.height - (top + gap) });
      }
      for (let p of pipes) {
        p.x -= 2;
        if (p.x + p.w < 0) { pipes.shift(); score++; }
        if (isColliding(bird, p)) endGame();
      }
    }

    function drawScore() {
      ctx.fillStyle = "var(--ui-text)";
      ctx.font = "24px system-ui, sans-serif";
      ctx.textAlign = "left";
      ctx.fillText("Score: " + score, 10, 30);
    }

    function drawCenterText(text, size = 32, color = "var(--ui-accent)", yOffset = 0) {
      ctx.fillStyle = color;
      ctx.font = `${size}px system-ui, sans-serif`;
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, canvas.height / 2 + yOffset);
    }

    function endGame() {
      gameState = "gameover";
      restartBtn.style.display = "block";
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();

      if (gameState === "start") {
        drawBird();
        drawCenterText("NateyBird", 40, "var(--ui-text)", -40);
        drawCenterText("Tap or Press Space to Start", 18, "var(--ui-muted)", 20);
      }

      if (gameState === "play") {
        updateBird();
        updatePipes();
        drawPipes();
        drawBird();
        drawScore();
        frame++;
      }

      if (gameState === "gameover") {
        drawPipes();
        drawBird();
        drawScore();
        drawCenterText("Game Over!", 32, "var(--ui-accent)", -20);
        drawCenterText("Final Score: " + score, 20, "var(--ui-text)", 20);
      }

      requestAnimationFrame(gameLoop);
    }

    function flap() {
      if (gameState === "start") {
        gameState = "play";
      } else if (gameState === "play") {
        bird.velocity = bird.lift;
      }
    }

    document.addEventListener("keydown", (e) => { if (e.code === "Space") flap(); });
    canvas.addEventListener("click", flap);
    canvas.addEventListener("touchstart", flap);
    restartBtn.addEventListener("click", () => { initGame(); });

    birdImg.onload = () => { initGame(); gameLoop(); };
  </script>

<footer class="site-footer">
  <p>NateBot 5.0 &mdash; <a href="patchnotes.html">Patch Notes</a></p>
</footer>
</body>
</html>
